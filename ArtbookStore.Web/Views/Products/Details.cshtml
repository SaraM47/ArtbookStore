@model ArtbookStore.Web.Models.Product

@{
    ViewData["Title"] = Model.Title;
}

<!-- Breadcrumb navigation for better UX and accessibility -->
<nav class="product-breadcrumb" aria-label="Breadcrumb">

    <a asp-controller="Home" asp-action="Index" class="breadcrumb-link">
        Home
    </a>

    <span>/</span>

    <a asp-action="Index" class="breadcrumb-link">
        Shop
    </a>

    <span>/</span>

    <strong aria-current="page" class="breadcrumb-current">
        @Model.Title
    </strong>

</nav>

<section class="product-details-section">

    <div class="product-details-container">

        <!-- Image -->
        <div class="product-image-wrapper">
            @if (!string.IsNullOrEmpty(Model.ImageUrl))
            {
                <img src="@Model.ImageUrl"
                     alt="@Model.Title by @Model.Author"
                     class="product-image" />
            }
        </div>

        <!-- Content -->
        <div class="product-info">

            <h1 class="product-title">@Model.Title</h1>

            <p class="product-description">
                @Model.Description
            </p>

            <p class="product-price">
                @Model.Price.ToString("C")
            </p>


            <!-- Purchase logic in this in that  log in as customer and the product is in stock, will show Add to cart form. If it's out of stock it will show warning. If the user is Not logged in, it will show login link -->
            @if (User.IsInRole("Customer") && Model.StockQuantity > 0)
            {
                <form asp-controller="Orders"
                    asp-action="Create"
                    method="post"
                    class="product-form">

                    @Html.AntiForgeryToken()

                    <!-- This is sent to OrdersController.Create -->
                    <input type="hidden" name="productId" value="@Model.Id" />

                    <div class="quantity-control">
                    <button type="button"
                            class="sf-qty-btn"
                            onclick="changeQty(-1)">
                        <i class="bi bi-dash"></i>
                    </button>

                    <input type="number"
                        id="quantity"
                        name="quantity"
                        value="1"
                        min="1"
                        max="@Model.StockQuantity"
                        class="sf-qty-input"
                        aria-label="Quantity" />

                    <button type="button"
                            class="sf-qty-btn"
                            onclick="changeQty(1)">
                        <i class="bi bi-plus"></i>
                    </button>
                    </div>

                    <button type="submit" class="product-btn">
                        Add to cart
                    </button>
                </form>
            }
            else if (Model.StockQuantity <= 0)
            {
                <div class="stock-warning">
                    Out of stock
                </div>
            }
            else
            {
                <!-- If user is not a Customer, send them to login -->
                <a class="product-btn"
                   asp-area="Identity"
                   asp-page="/Account/Login">
                    Login to purchase
                </a>
            }

            <!-- Additional product metadata -->
            <div class="product-meta">

                <h4>Details:</h4>

                <p><strong>Author:</strong> @Model.Author</p>
                <p><strong>Category:</strong> @Model.Category?.Name</p>
                <p><strong>Published:</strong> @Model.CreatedAt.Year</p>
                <p><strong>In Stock:</strong> @Model.StockQuantity</p>

            </div>
        </div>
    </div>

</section>

@section Scripts {
<script>
// Simple client-side quantity control, that ensures quantity stays between 1 and the available stock.
function changeQty(amount) {
    const input = document.getElementById("quantity");
    let value = parseInt(input.value);
    let max = parseInt(input.max);

    value += amount;

// If user click plus when quantity is 5 and max is 5, it will try to set value to 6, but this code will reset it back to 5. Same for minus button when quantity is 1, it will try to set value to 0, but this code will reset it back to 1.
    if (value < 1) value = 1;
    if (value > max) value = max;

    input.value = value;
}
</script>
}